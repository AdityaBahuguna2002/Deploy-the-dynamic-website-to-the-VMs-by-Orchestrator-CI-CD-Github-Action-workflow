Step 1: Repository Structure
Here’s how your Git repository will be structured:

Copy
my-website-repo/
├── terraform/
│   ├── main.tf          # Terraform configuration for VMs
│   ├── variables.tf     # Variables for Terraform
│   └── outputs.tf       # Outputs (e.g., VM IPs)
├── ansible/
│   ├── playbook.yml     # Ansible playbook for configuration
│   ├── inventory        # Dynamic inventory for Ansible
│   └── roles/           # Optional: Ansible roles for better organization
├── app/
│   └── website/         # Your dynamic website code (e.g., PHP files)
└── .github/workflows/
    └── ci-cd.yml        # GitHub Actions workflow file
Step 2: Terraform Configuration
Create the Terraform configuration to deploy 3 VMs.

terraform/main.tf
hcl
Copy
provider "aws" {
  region = "us-east-1"
}

resource "aws_instance" "web_server" {
  count         = 3
  ami           = "ami-0c55b159cbfafe1f0" # Replace with your AMI ID
  instance_type = "t2.micro"

  tags = {
    Name = "web-server-${count.index + 1}"
  }
}

output "instance_ips" {
  value = aws_instance.web_server[*].public_ip
}
terraform/variables.tf
hcl
Copy
variable "region" {
  default = "us-east-1"
}
terraform/outputs.tf
hcl
Copy
output "instance_ips" {
  value = aws_instance.web_server[*].public_ip
}
Step 3: Ansible Playbook
Create an Ansible playbook to install the web server and required software.

ansible/playbook.yml
yaml
Copy
- name: Configure web servers
  hosts: all
  become: yes
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present

    - name: Install PHP
      apt:
        name:
          - php
          - php-mysql
        state: present

    - name: Install MySQL
      apt:
        name: mysql-server
        state: present

    - name: Copy website files
      copy:
        src: ../../app/website/
        dest: /var/www/html/
ansible/inventory
This file will be dynamically generated by Terraform in the GitHub Actions workflow.

Step 4: GitHub Actions Workflow
Create a GitHub Actions workflow to automate the entire pipeline.

.github/workflows/ci-cd.yml
yaml
Copy
name: CI/CD Pipeline
on:
  push:
    branches:
      - main

jobs:
  validate-terraform:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Validate Terraform
        run: |
          cd terraform
          terraform init
          terraform validate

  deploy-infra:
    runs-on: ubuntu-latest
    needs: validate-terraform
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Provision infrastructure
        run: |
          cd terraform
          terraform init
          terraform apply -auto-approve

      - name: Generate Ansible inventory
        run: |
          cd terraform
          echo "[webservers]" > ../ansible/inventory
          terraform output -raw instance_ips | tr -d '[]",' | xargs -n1 echo >> ../ansible/inventory

  configure-infra:
    runs-on: ubuntu-latest
    needs: deploy-infra
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Configure infrastructure
        run: |
          cd ansible
          ansible-playbook -i inventory playbook.yml --user ubuntu --private-key ${{ secrets.SSH_PRIVATE_KEY }}

  deploy-app:
    runs-on: ubuntu-latest
    needs: configure-infra
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Deploy website
        run: |
          cd ansible
          ansible-playbook -i inventory playbook.yml --user ubuntu --private-key ${{ secrets.SSH_PRIVATE_KEY }}
Step 5: Dynamic Website Code
Place your dynamic website code in the app/website/ directory. For example:

app/website/index.php
php
Copy
<?php
echo "Hello, World! This is a dynamic website running on Nginx and PHP.";
?>
Step 6: Secrets and SSH Keys
SSH Private Key: Store your SSH private key in GitHub Secrets (SSH_PRIVATE_KEY).

Cloud Credentials: Store your cloud provider credentials (e.g., AWS access keys) in GitHub Secrets.

Step 7: Run the Pipeline
Push your code to the main branch in GitHub.

The GitHub Actions workflow will:

Validate the Terraform configuration.

Provision 3 VMs using Terraform.

Configure the VMs using Ansible (install Nginx, PHP, MySQL, and deploy the website).

Deploy the dynamic website to the VMs.
